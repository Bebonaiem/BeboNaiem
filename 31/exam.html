<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>موقع الامتحان</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="icon" href="logo.png" type="image/x-icon">
    <style>
        :root {
            /* Deepest Black Theme Palette */
            --bg-deep-dark: #050505;         
            --bg-dark-primary: #101010;     
            --bg-dark-secondary: #1c1c1c;   
            --bg-dark-tertiary: #2b2b2b;   
            
            --accent-primary: #00c6ff;     
            --accent-secondary: #00a9e0;   
            --accent-tertiary: #008ac7;   

            --text-primary: #fdfdfd;       
            --text-secondary: #e5e5e5;     
            --text-muted: #b3b3b3;         

            --border-color: #303030;       
            --border-strong-color: #4a4a4a; 

            --success-color: #28a745; 
            --success-background-tint: rgba(40, 167, 69, 0.07);
            --error-color: #dc3545;   
            --error-background-tint: rgba(220, 53, 69, 0.07);
            
            --warning-primary: #fbbf24;   
            --warning-secondary: #f59e0b;

            --shadow-color-light: rgba(200, 200, 200, 0.03); 
            --shadow-color-medium: rgba(200, 200, 200, 0.05);
            --shadow-sm: 0 3px 6px var(--shadow-color-light);
            --shadow-md: 0 6px 12px var(--shadow-color-medium);
            --shadow-lg: 0 12px 28px var(--shadow-color-medium), 0 8px 12px var(--shadow-color-light);
            --shadow-inset: inset 0 2px 4px rgba(0,0,0,0.6); 

            --border-radius-sm: 8px; 
            --border-radius-md: 14px; 
            --border-radius-lg: 20px;
            --border-radius-xl: 28px;

            --font-main: 'Tajawal', sans-serif;
            --transition-fast: all 0.2s ease-in-out;
            --transition-smooth: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-deep-dark);
            color: var(--text-primary);
            line-height: 1.75; 
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 25px 15px; 
            overflow-x: hidden;
        }

        .container {
            background-color: var(--bg-dark-primary);
            border-radius: var(--border-radius-xl);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 880px; 
            padding: 40px 45px; 
            margin: 30px 0;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden; 
        }
         .container::before { 
            content: '';
            position: absolute;
            top: -100px;
            right: -100px;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(0, 198, 255, 0.02) 0%, rgba(0, 198, 255, 0) 60%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 0;
            filter: blur(15px); 
        }
        main, header, footer {
            position: relative; 
            z-index: 1;
        }

        /* --- Screen Transitions --- */
        .screen {
            animation: fadeInScreen 0.6s var(--transition-smooth) forwards;
        }
        .screen.hidden { display: none !important; }

        @keyframes fadeInScreen {
            from { opacity: 0; transform: translateY(15px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        header {
            text-align: center;
            padding-bottom: 30px;
            margin-bottom: 35px;
            border-bottom: 1px solid var(--border-color);
        }

        header h1 {
            font-size: 2.6em; 
            font-weight: 900; 
            color: var(--accent-primary);
            letter-spacing: 1px; 
            margin-bottom: 20px;
            text-shadow: 0 0 18px rgba(0, 198, 255, 0.55); 
        }

        .timer {
            background-color: var(--bg-dark-secondary);
            color: var(--warning-primary);
            padding: 12px 25px;
            border-radius: var(--border-radius-md);
            font-size: 1.25em;
            font-weight: 700;
            display: inline-flex; 
            align-items: center;
            gap: 10px;
            border: 1px solid var(--border-strong-color);
            box-shadow: var(--shadow-md);
            transition: var(--transition-smooth);
        }
        .timer:hover {
            transform: scale(1.03);
            box-shadow: 0 5px 15px var(--shadow-color-medium);
        }
        .timer i { font-size: 1.2em; margin-left: 5px; }


        /* --- Welcome Screen --- */
        .welcome-screen { text-align: center; padding: 30px 0; }
        .welcome-screen .start-icon-container {
            width: 90px;
            height: 90px;
            background: linear-gradient(145deg, var(--accent-primary), var(--accent-tertiary));
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto 30px auto;
            box-shadow: 0 0 25px rgba(0, 198, 255, 0.3);
            color: var(--bg-deep-dark);
            transition: transform 0.35s ease;
        }
        .welcome-screen .start-icon-container:hover {
            transform: rotate(10deg) scale(1.12);
        }
        .welcome-screen .start-icon-container i { font-size: 3em; }
        .welcome-screen h2 {
            font-size: 2.3em;
            color: var(--text-primary);
            margin-bottom: 20px;
            font-weight: 800;
        }
        .welcome-screen p {
            font-size: 1.1em;
            color: var(--text-secondary);
            margin-bottom: 18px;
            max-width: 650px;
            margin-left: auto;
            margin-right: auto;
        }
        .welcome-screen p strong { color: var(--accent-primary); font-weight: 700; }
        .welcome-screen .custom-credit {
            font-size: 0.95em;
            color: var(--text-muted);
            margin-top: 20px; /* Adjusted margin */
            margin-bottom: 25px; /* Added margin before buttons */
        }
        .welcome-actions { 
            margin-top: 25px;
            display: flex;
            flex-direction: column; 
            align-items: center;
            gap: 15px;
        }
        #view-old-results-btn {
            background: transparent;
            border-color: var(--text-muted);
            color: var(--text-muted);
            font-weight: 500; 
            padding: 10px 20px;
        }
        #view-old-results-btn:hover:not(:disabled) {
            background: var(--bg-dark-tertiary);
            border-color: var(--text-secondary);
            color: var(--text-secondary);
        }


        /* --- Question Container --- */
        .question-container { padding: 20px 0; }
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 12px 20px;
            background-color: var(--bg-dark-secondary);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-sm);
        }
        #question-number {
            font-size: 1.05em;
            font-weight: 700;
            color: var(--text-secondary);
        }
        .progress-bar-container {
            width: 70%; 
            height: 12px; 
            background-color: var(--bg-dark-tertiary);
            border-radius: 6px;
            overflow: hidden;
            box-shadow: var(--shadow-inset);
        }
        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--accent-tertiary) 0%, var(--accent-primary) 100%);
            border-radius: 6px;
            transition: width 0.55s cubic-bezier(0.23, 1, 0.32, 1); 
        }
        #question-text {
            font-size: 1.7em; 
            font-weight: 500; 
            color: var(--text-primary);
            margin-bottom: 35px;
            text-align: right;
            padding: 22px 25px;
            background-color: var(--bg-dark-secondary); 
            border-radius: var(--border-radius-lg);
            border-left: 4px solid var(--accent-primary); 
            box-shadow: var(--shadow-md);
        }
        .options-container { display: grid; grid-template-columns: 1fr; gap: 15px; }
        .option-item {
            background-color: var(--bg-dark-secondary);
            border: 1.5px solid var(--border-color); 
            border-radius: var(--border-radius-md);
            padding: 18px 22px; 
            cursor: pointer;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            font-size: 1.15em;
            color: var(--text-secondary);
            box-shadow: var(--shadow-sm);
        }
        .option-item:hover {
            background-color: var(--bg-dark-tertiary);
            border-color: var(--accent-primary);
            color: var(--text-primary);
            transform: translateY(-3.5px) scale(1.005); 
            box-shadow: 0 3.5px 9px var(--shadow-color-medium);
        }
        .option-item input[type="radio"] { display: none; }
        .option-item .custom-radio {
            width: 25px; 
            height: 25px;
            border: 2.5px solid var(--text-muted); 
            border-radius: 50%;
            margin-left: 18px;
            flex-shrink: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: var(--transition-fast);
        }
        .option-item:hover .custom-radio { border-color: var(--accent-primary); }
        .option-item input[type="radio"]:checked + .custom-radio {
            border-color: var(--accent-primary);
            background-color: var(--accent-primary);
            box-shadow: 0 0 12px rgba(0, 198, 255, 0.65); 
        }
        .option-item input[type="radio"]:checked + .custom-radio::after {
            content: '\f00c'; 
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            font-size: 12.5px; 
            color: var(--bg-deep-dark);
        }
        .option-item.selected {
            background-color: var(--bg-dark-tertiary);
            border-color: var(--accent-primary) !important;
            color: var(--text-primary);
        }
        .option-item.selected .custom-radio {
             border-color: var(--accent-primary) !important;
             background-color: var(--accent-primary) !important;
             box-shadow: 0 0 12px rgba(0, 198, 255, 0.65) !important;
        }

        /* --- Navigation & Action Buttons --- */
        .navigation-buttons { display: flex; justify-content: space-between; margin-top: 35px; gap: 18px;}
        
        button, .modal-button { 
            padding: 13px 28px; 
            border-radius: var(--border-radius-md);
            cursor: pointer;
            font-size: 1.05em;
            font-weight: 800; 
            transition: var(--transition-smooth);
            font-family: var(--font-main);
            display: inline-flex;
            align-items: center;
            justify-content: center; 
            gap: 9px; 
            text-transform: uppercase;
            letter-spacing: 0.75px;
            border: 2.5px solid transparent; 
            position: relative; 
            overflow: hidden; 
        }
        
        button:not(.outline):not(.warning):not(#view-old-results-btn), 
        .modal-button:not(.cancel) { /* Primary buttons, excluding specific ones */
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: var(--bg-deep-dark); 
            box-shadow: 0 3.5px 10px rgba(0, 198, 255, 0.18), var(--shadow-sm);
        }
        button:not(.outline):not(.warning):not(#view-old-results-btn):hover:not(:disabled),
        .modal-button:not(.cancel):hover:not(:disabled) {
            background: linear-gradient(135deg, var(--accent-secondary), var(--accent-tertiary));
            transform: translateY(-2.5px) scale(1.025);
            box-shadow: 0 5.5px 14px rgba(0, 198, 255, 0.28), var(--shadow-md);
        }
        
        button:disabled, .modal-button:disabled {
            background: var(--bg-dark-tertiary) !important; 
            color: var(--text-muted) !important;
            cursor: not-allowed;
            opacity: 0.55; 
            box-shadow: none !important;
            border-color: var(--bg-dark-tertiary) !important;
        }

        #submit-btn { 
            background: linear-gradient(135deg, var(--success-color), #1e7e34); 
            color: #fff; 
        }
        #submit-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #1e7e34, #155d27); 
        }
        
        button i, .modal-button i { font-size: 1em; }
        
        /* --- Results Container --- */
        .results-container { text-align: center; padding: 30px 0; }
        .results-container .result-actions {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap; 
            gap: 15px; 
            margin-top: 25px;
        }
        .results-container .result-actions button {
            min-width: 200px; 
        }

        /* Review Button - Outline Style Refined */
        #review-btn {
            background: transparent;
            border-color: var(--accent-primary); 
            color: var(--accent-primary);
            box-shadow: none;
        }
        #review-btn:hover:not(:disabled) {
            background: var(--accent-primary);
            color: var(--bg-deep-dark);
            border-color: var(--accent-primary);
            box-shadow: 0 5.5px 14px rgba(0, 198, 255, 0.28); 
        }

        /* Retake Button - Warning Style Refined */
        #retake-btn {
            background: linear-gradient(135deg, var(--warning-primary), var(--warning-secondary));
            color: var(--bg-deep-dark); 
            border-color: transparent; 
            box-shadow: 0 3.5px 10px rgba(251, 191, 36, 0.18), var(--shadow-sm);
        }
        #retake-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--warning-secondary), #d97706); 
            box-shadow: 0 5.5px 14px rgba(251, 191, 36, 0.28), var(--shadow-md);
        }


        .results-container h2 {
            font-size: 2.6em;
            color: var(--accent-primary);
            margin-bottom: 30px;
            font-weight: 800;
        }
        .results-container .score-display {
            background-color: var(--bg-dark-secondary);
            padding: 28px 32px;
            border-radius: var(--border-radius-lg);
            margin-bottom: 35px;
            border: 1px solid var(--border-strong-color);
            box-shadow: var(--shadow-md);
        }
        .results-container p {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: var(--text-secondary);
        }
        .results-container p span, .results-container p#percentage {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 1.3em;
        }
         .results-container p#percentage {
            color: var(--success-color); 
            font-size: 1.9em; 
            margin-top: 15px;
            display: block; 
         }
         .results-container .back-to-welcome-btn { 
            margin-top: 20px;
            background: var(--bg-dark-tertiary);
            color: var(--text-secondary);
         }
         .results-container .back-to-welcome-btn:hover {
            background: var(--border-strong-color);
            color: var(--text-primary);
         }


        /* --- Review Container --- */
        .review-container { padding: 20px 0; }
        .review-container h2 {
            font-size: 2.3em;
            color: var(--accent-primary);
            margin-bottom: 35px;
            text-align: center;
            font-weight: 800;
        }
        .review-list {
            max-height: 420px; 
            overflow-y: auto;
            padding: 4px 12px 4px 4px; 
            margin-right: -12px; 
        }
        .review-list::-webkit-scrollbar { width: 8px; }
        .review-list::-webkit-scrollbar-track { background: var(--bg-dark-tertiary); border-radius: 4px; }
        .review-list::-webkit-scrollbar-thumb { background: var(--accent-secondary); border-radius: 4px; }
        .review-list::-webkit-scrollbar-thumb:hover { background: var(--accent-primary); }

        .review-item {
            background-color: var(--bg-dark-secondary);
            border-radius: var(--border-radius-md);
            padding: 20px 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-md);
            transition: var(--transition-smooth);
            border-left: 6px solid var(--border-strong-color); 
        }
        .review-item:hover { transform: scale(1.012) translateX(4px); box-shadow: var(--shadow-lg); }
        
        .review-item-correct {
            border-left-color: var(--success-color) !important; 
            background-color: var(--success-background-tint); 
        }
        .review-item-incorrect {
            border-left-color: var(--error-color) !important; 
            background-color: var(--error-background-tint); 
        }
        .review-item-unanswered { 
            border-left-color: var(--text-muted) !important;
        }

        .review-item p { margin-bottom: 10px; font-size: 1.05em; }
        .review-item .question-text-review {
            font-weight: 700; 
            color: var(--text-primary);
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        .review-item .your-answer-review, .review-item .correct-answer-review {
            padding: 7px 10px;
            border-radius: var(--border-radius-sm);
            display: block; 
            margin-top: 8px;
            font-weight: 500;
            border: 1px dashed transparent; 
        }
        .review-item-incorrect .your-answer-review { 
            color: var(--error-color);
            border-color: rgba(220, 53, 69, 0.4); 
        }
        .review-item-correct .correct-answer-review { 
            color: var(--success-color);
        }
         .review-item-incorrect .correct-answer-review { 
            color: var(--success-color);
            border-color: rgba(40, 167, 69, 0.4);
        }


        #back-to-results-btn { margin-top: 30px; display: block; margin-left: auto; margin-right: auto; }

        /* --- Custom Modal --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9); 
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.35s ease, visibility 0s linear 0.35s;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.35s ease;
        }
        .modal-content {
            background-color: var(--bg-dark-primary);
            padding: 35px 40px; 
            border-radius: var(--border-radius-lg);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
            text-align: center;
            width: 90%;
            max-width: 480px; 
            border: 1px solid var(--border-strong-color);
            transform: scale(0.92) translateY(15px);
            transition: transform 0.35s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s ease; 
        }
        .modal-overlay.active .modal-content {
            transform: scale(1) translateY(0px);
        }
        .modal-title {
            font-size: 1.7em;
            font-weight: 800;
            color: var(--accent-primary);
            margin-bottom: 18px;
        }
        .modal-message {
            font-size: 1.1em;
            color: var(--text-secondary);
            margin-bottom: 30px;
            line-height: 1.65;
        }
        .modal-actions {
            display: flex;
            justify-content: center; 
            gap: 15px;
        }
        .modal-button.cancel { 
            background: var(--bg-dark-tertiary);
            color: var(--text-secondary);
            border-color: var(--bg-dark-tertiary);
        }
        .modal-button.cancel:hover {
            background: var(--border-strong-color);
            color: var(--text-primary);
            border-color: var(--border-strong-color);
        }


        /* --- Footer --- */
        footer {
            text-align: center;
            padding-top: 30px;
            margin-top: 35px;
            border-top: 1px solid var(--border-color);
            color: var(--text-muted);
            font-size: 0.9em;
            font-weight: 400; 
        }
        footer p { opacity: 0.65; }
        footer .made-by {
            color: var(--accent-primary);
            font-weight: 700;
        }

        /* --- Responsive Adjustments --- */
        @media (max-width: 768px) {
            .container { padding: 30px 25px; margin: 20px 0; }
            header h1 { font-size: 2.1em; }
            .timer { font-size: 1.1em; padding: 10px 20px; }
            .welcome-screen h2 { font-size: 1.9em; }
            #question-text { font-size: 1.45em; padding: 20px; }
            .option-item { padding: 16px 20px; font-size: 1.1em; }
            button, .modal-button { padding: 12px 22px; font-size: 1em; }
            .results-container h2 { font-size: 2.2em; }
            .review-container h2 { font-size: 1.9em; }
            .modal-title { font-size: 1.5em;}
            .modal-message { font-size: 1em;}
            .results-container .result-actions button { min-width: 180px; }
        }
        @media (max-width: 480px) {
            body { padding: 10px; }
            .container { padding: 25px 15px; }
            header h1 { font-size: 1.8em; }
            .timer { font-size: 1em; padding: 8px 15px; }
            #question-text { font-size: 1.25em; margin-bottom: 25px; padding: 18px; }
            .option-item { font-size: 1em; padding: 14px; }
            .option-item .custom-radio { margin-left: 12px; width: 22px; height: 22px;}
            .navigation-buttons { flex-direction: column; gap: 12px; }
            .navigation-buttons button { width: 100%; }
            .results-container .result-actions { flex-direction: column; }
            .results-container .result-actions button { width: 100%; min-width: unset; margin: 8px 0;}
            .welcome-screen .start-icon-container { width: 70px; height: 70px; margin-bottom: 20px; }
            .welcome-screen .start-icon-container i { font-size: 2.5em; }
            .welcome-actions button { width: 90%; max-width: 300px;} 
            .review-list { padding-right: 8px; margin-right: -8px;}
            .modal-content { padding: 25px 20px;}
            .modal-actions { flex-direction: column; }
            .modal-actions .modal-button { width: 100%; }
        }

    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>الاختبار الشامل المتقدم</h1>
            <div class="timer" id="timer"><i class="fa-solid fa-clock-rotate-left"></i> الزمن المتبقي: 45:00</div>
        </header>

        <main id="exam-content">
            <div class="welcome-screen screen" id="welcome-screen">
                <div class="start-icon-container">
                    <i class="fa-solid fa-user-astronaut"></i>
                </div>
                <h2>مرحباً بك أيها المستكشف!</h2>
                <p>انطلق في رحلة معرفية مع 60 سؤالاً مصممة لاختبار حدود فهمك.
                    التركيز هو مفتاحك للنجاح.
                </p>
                <p>لديك <strong id="welcome-time-duration">45 دقيقة</strong> لإكمال التحدي. حظاً موفقاً!</p>
                <p class="custom-credit">تم عمله بواسطة : بولا نعيم ادمن و ليس ليدر</p>
                <p class="custom-credit">تحت اشراف : ابانوب جورج الليدر</p>
                <div class="welcome-actions">
                    <button id="start-exam-btn"><i class="fa-solid fa-shuttle-space"></i> ابدأ الرحلة المعرفية</button>
                    <button id="view-old-results-btn" class="outline"><i class="fa-solid fa-history"></i> عرض النتائج السابقة</button>
                </div>
            </div>

            <div class="question-container screen hidden" id="question-container">
                <div class="question-header">
                    <span id="question-number">السؤال 1/60</span>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progress-bar"></div>
                    </div>
                </div>
                <h2 id="question-text">نص السؤال يظهر هنا...</h2>
                <div class="options-container" id="options-container">
                    <!-- Options loaded by JS -->
                </div>
                <div class="navigation-buttons">
                    <button id="prev-btn" disabled><i class="fa-solid fa-chevron-left"></i> السؤال السابق</button>
                    <button id="next-btn">السؤال التالي <i class="fa-solid fa-chevron-right"></i></button>
                    <button id="submit-btn" class="hidden"><i class="fa-solid fa-paper-plane"></i> إنهاء وتسليم</button>
                </div>
            </div>

            <div class="results-container screen hidden" id="results-container">
                <h2 id="results-title"><i class="fa-solid fa-medal"></i> تقرير الأداء النهائي</h2>
                <div class="score-display">
                    <p>عدد الأسئلة التي تمت الإجابة عليها: <span id="answered-count">0</span> من <span id="results-total-q-count1">60</span></p>
                    <p>مجموع النقاط (الإجابات الصحيحة): <span id="score">0</span> / <span id="results-total-q-count2">60</span></p>
                    <p id="percentage">النسبة المئوية للإتقان: 0%</p>
                    <p id="old-result-timestamp" class="hidden" style="font-size: 0.9em; color: var(--text-muted); margin-top: 10px;"></p>
                </div>
                <div class="result-actions">
                    <button id="review-btn" class="hidden"><i class="fa-solid fa-magnifying-glass-chart"></i> تحليل الإجابات</button>
                    <button id="retake-btn"><i class="fa-solid fa-repeat"></i> خوض التحدي مجدداً</button>
                    <button id="back-to-welcome-btn" class="hidden outline"><i class="fa-solid fa-home"></i> العودة للرئيسية</button>
                </div>
            </div>

            <div class="review-container screen hidden" id="review-container">
                <h2><i class="fa-solid fa-microscope"></i> المراجعة الدقيقة للإجابات</h2>
                <div class="review-list" id="review-list">
                    <!-- Review items loaded by JS -->
                </div>
                <button id="back-to-results-btn"><i class="fa-solid fa-arrow-left-long"></i> العودة لتقرير الأداء</button>
            </div>
        </main>
        <footer>
            <p>2025 © <span class="made-by">Made by BeboNaiem</span></p>
        </footer>
    </div>

    <!-- Custom Modal for Confirmation -->
    <div class="modal-overlay hidden" id="confirmation-modal-overlay">
        <div class="modal-content">
            <h3 class="modal-title" id="modal-title-text">تأكيد الإنهاء</h3>
            <p class="modal-message" id="modal-message-text">هل أنت متأكد من رغبتك في إنهاء الاختبار وتسليم إجاباتك؟ لا يمكنك التراجع بعد ذلك.</p>
            <div class="modal-actions">
                <button class="modal-button cancel" id="modal-cancel-btn"><i class="fa-solid fa-ban"></i> إلغاء الأمر</button>
                <button class="modal-button" id="modal-confirm-btn"><i class="fa-solid fa-circle-check"></i> نعم، تأكيد الإنهاء</button>
            </div>
        </div>
    </div>

    <script>
        // Raw content from qq.txt 
        const rawQuestionsText = `
ملف الأسئلة والأجوبة

ضع علامه ( √ ) أمام العبارة الصحيحة وعبارة (x) أمام العبارات الخاطئة.

1. أسلوب التدريس هو طريقة من طرق التدريس التي يتبعها المعلم
الإجابة: X

2. الأهداف السلوكية هى أهداف تصف ما يقوم به المعلم
الإجابة: X

3. يركز المجال الوجداني للأهداف على القيم والإتجاهات والميول التي يجب أن يكتسبها المتعلمين
الإجابة: √

4. التعلم التعاوني هو طريقة تقليدية في التدريس
الإجابة: X

5. من شروط التعلم التعاونى أن تتكون المجموعة من على الأكثر ۰۲ فرد أو ۰۲ (ملاحظة: النص الأصلي غير واضح، يفترض أن يكون رقمين مختلفين أو مدى)
الإجابة: X (بناءً على أن 20 أو 25 فرداً كثير جداً للتعلم التعاوني الفعال، عادة 4-6)

6. التعلم بالبحث يساعد المتعلمين على السعى نحو المعلومات والحلول تجاه موضوع ما
الإجابة: √

7. استخدام التعلم بالبحث ينمى لدى المتعلم مهارات التعلم الذاتي
الإجابة: √

8. استخدام التعلم بالبحث لا يساعد المتعلم على اكتساب الثقه بالنفس
الإجابة: X

9. إجراء التجارب والتمارين والأنشطة من صور التعلم بالبحث
الإجابة: √

10. مهارات التأكيد على المفاهيم والافكار الرئيسية من مهارات التعلم بالبحث
الإجابة: √

11. التعلم الالكتروني هو منظومة تعليمية لتقديم البرامج التعليمية للمتعلمين فى اى وقت واي مكان
الإجابة: √

12. من أسس التعلم الالكترونى التقييد بالزمان والمكان
الإجابة: X

13. بيئات التعلم التقليدى هى كل البيئات التي يوجد فيها كل من المعلم والمتعلم والمحتوى التعليمى في حيز واحد
الإجابة: √

14. بيئة التعلم الالكتروني تسمح للطالب بالتفاعل مع مصادر التعلم البشرية وغير البشرية
الإجابة: √

15. التمركز حول المعلم من خصائص بيئات التعلم التفاعلية الالكترونية
الإجابة: X

16. ارتباط الاستراتيجية بالمحتوى التدريسي من اسس توظيف استراتيجيات التعلم الإلكتروني
الإجابة: X (الأصح ارتباطها بالأهداف)

17. من اسس توظيف استراتيجيات التعلم الإلكتروني المرونة والقابلية للتطوير
الإجابة: √

18. موقف التعلم ومتطلباته من معايير اختيار استراتيجيات التعلم الالكتروني
الإجابة: √

19. المحاضرة الالكترونية هي طريقه ذات اتجاه واحد من المعلم الى طلابه
الإجابة: √

20. من مميزات المحاضرة الالكترونية مشاهدة المتعلم المحاضرة في وقت ومكان محدد
الإجابة: X (المميز هو عدم التقييد بوقت ومكان محدد)

21. تقدم العروض الالكترونية وفق نمطين نمط متزامن ونمط غير متزامن
الإجابة: √

22. تستخدم العروض الالكترونية في تدريس العلاقات المتبادلة والتمكن من المهارات
الإجابة: √

23. أسلوب التدريس هو طريقة من طرق التدريس التي يتبعها المعلم.
الإجابة: √ (مكرر من 1 ولكن الإجابة هنا صحيحة، بينما في 1 خطأ. سأعتمد على الإجابة بجانب الرقم)

24. الأهداف السلوكية هى أهداف تصف ما يقوم به المعلم.
الإجابة: X

25. يركز المجال الوجداني للأهداف على القيم والإتجاهات والميول التي يجب أن يكتسبها المتعلمين.
الإجابة: √

26. التعلم التعاوني هو طريقة تقليدية في التدريس.
الإجابة: X

27. من شروط التعلم التعاونى أن تتكون المجموعة من ۲۰ فرد أو ٢٥ على الأكثر.
الإجابة: X

28. التعلم بالبحث يساعد المتعلمين على السعى نحو المعلومات والحلول تجاه موضوع ما.
الإجابة: √

29. استخدام التعلم بالبحث ينمى لدى المتعلم مهارات التعلم الذاتي.
الإجابة: √

30. استخدام التعلم بالبحث لا يساعد المتعلم على اكتساب الثقه بالنفس.
الإجابة: X

31. إجراء التجارب والتمارين والأنشطة من صور التعلم بالبحث.
الإجابة: √

32. مهارات التأكيد على المفاهيم والافكار الرئيسية من مهارات التعلم بالبحث.
الإجابة: √

33. التعلم هو عملية ذاتية وفردية يقوم بها المتعلم لاكتساب المعرفة والمهارات والخبرات من خلال التفاعل في البيئة المحيطة
الإجابة: √

34. التعلم يعتمد على دافعية المتعلم واستعدادة النفسي
الإجابة: √

35. التعلم هو عملية ذاتية يقوم بها المعلم لاكتساب المعرفة
الإجابة: X (التعلم أوسع من مجرد اكتساب المعرفة، يشمل المهارات والخبرات والتفاعل)

36. التعلم هو عملية يقوم بها المعلم لايصال المعرفة للمتعلمين
الإجابة: X (هذا تعريف للتعليم وليس التعلم)

37. التدريس هو عبارة عن طريقة التدريس التي يستخدمها المعلم
الإجابة: X (التدريس أعم من مجرد طريقة، الطريقة جزء من التدريس)

38. التدريس اطار عملي يجمع بين التعليم والتعلم
الإجابة: √

39. التدريس عملية تفاعلية تضمن تخطيطا وتنفيذا وتقويماً من قبل المعلم
الإجابة: √

40. التدريس هو شرح الدروس من قبل المعلم
الإجابة: X (هذا جزء بسيط جداً من التدريس)

41. طريقة التدريس تشمل أسلوب التدريس واستراتيجية التدريس
الإجابة: X (العكس هو الأقرب، الاستراتيجية تشمل الطريقة والأسلوب)

42. أسلوب التدريس اعم واشمل من طريقة التدريس
الإجابة: X (الطريقة أعم من الأسلوب)

43. استراتيجية التدريس تشمل أسلوب وطريقة التدريس
الإجابة: √

44. تتكون منظومة التدريس من الكتاب المدرسي والمتعلم
الإجابة: X (تشمل المعلم، المحتوى، المتعلم، بيئة التعلم، طرق التقويم وغيرها)

45. عملية التدريس تتكون من مرحلتين تخطيط وتنفيذ
الإجابة: X (تشمل تخطيط وتنفيذ وتقويم)

46. الأهداف التربوية هي اهداف المناهج الدراسية
الإجابة: X (أهداف المناهج جزء من الأهداف التربوية الأعم)

47. تنقسم مستويات الأهداف التربوية الى اهداف عامة و اهداف خاصة و اهداف سلوكية
الإجابة: √

48. الأهداف التربوية تساعد المعلم في اختيار استراتيجيات التدريس المناسبة للاهداف ومستوى المتعلمين
الإجابة: √

49. يركز المجال المهاري على تنمية المهارات والقيم والاتجاهات
الإجابة: X (يركز على تنمية المهارات الحركية والأدائية)

50. الهدف السلوكي الجيد يصف سلوك المتعلم
الإجابة: √

51. الهدف السلوكي الجيد يجب ان يكون هدف مركبا
الإجابة: X (يجب أن يكون بسيطاً، محدداً، قابلاً للقياس)

52. طريقة التدريس هي وسيلة المعلم من أجل إيصال أهداف الدرس لطلابه
الإجابة: √

53. استراتيجية التدريس هي خطة المعلم الشاملة لتحقيق الأهداف بعيدة المدى
الإجابة: √

54. استراتيجية التدريس هي خطة شاملة يضعها المعلم لتحقيق الأهداف قريبة المدى
الإجابة: X (الأهداف التربوية العامة بعيدة المدى، والخاصة والسلوكية أقرب)

55. توجد في طرق التدريس بعض الطرق المثالية تماما التي ينبغي استخدامها
الإجابة: X (لا توجد طريقة مثالية تماماً لكل المواقف)

56. طريقة التعلم التعاوني من طرق التدريس التقليدي
الإجابة: X (من الطرق الحديثة)

57. طرائق التدريس الحديثة يكون المتعلم محوراً للعملية التعليمية
الإجابة: √

58. طرق التدريس التقليدية تكون المتعلم محورا للعملية التعليمية
الإجابة: X (المعلم هو المحور)

59. من القواعد العامة التي تبنى عليها طرق التدريس التدرج من الصعب الى السهل
الإجابة: X (من السهل إلى الصعب)

60. من القواعد العامة التي تبنى عليها طرق التدريس التدرج من المحسوس الى المعقول
الإجابة: √

61. طريقة المحاضرة تعتبر من الطرق الحديثة في التدريس
الإجابة: X (من الطرق التقليدية)

62. طريقة المحاضرة لا تسمح بعرض المعلومات بطريقة منظمة
الإجابة: X (تسمح بعرض المعلومات بطريقة منظمة)

63. تعد طريقة المناقشة من طرائق التدريس التقليدية
الإجابة: √ (يمكن اعتبارها تقليدية، ولكنها أكثر تفاعلية من المحاضرة البحتة)

64. من شروط المشكلة المختارة للدراسة ان تكون ذات صلة بالدرس
الإجابة: √

65. أسلوب التدريس هو طريقة من طرق التدريس الذي يتبعها المعلم في التدريس
الإجابة: √ (هنا الإجابة صح، مكرر من 1 و 23. يوجد تضارب في الإجابات الأولى)

66. الأهداف السلوية هي اهداف تصف ما يقوم به المعلم
الإجابة: X

67. يركز المجال الوجداني للأهداف على القيم والاتجاهات والميول التي يجب أن يكتسبها المتعلمون
الإجابة: √

---
ضع دائرة حول الحرف الذي يدل على الإجابة الصحيحة:

1. ما يلي من مميزات طريقة المحاضرة عدا:
    - طريقة تدريس اقتصادية
    - تسهم في تذكر الطلاب للمعلومات
    - تغطي حجم كبير من محتوى المقرر
    - لا تحتاج لاماكنيات كبير
الإجابة الصحيحة: تسهم في تذكر الطلاب للمعلومات (لأن المحاضرة قد لا تسهم بفعالية في التذكر العميق مقارنة بالطرق التفاعلية)

2. مراحل عملية التدريس هي:
    - مرحلة التخطيط
    - مرحلة التقويم
    - مرحلة التنفيذ
    - جميع ما سبق
الإجابة الصحيحة: جميع ما سبق

3. من النتقادات الموجهة لطريقة المحاضرة:
    - تثير دافعية الطلبة للتعليم
    - يمكن من خلالها إعطاء كم من المعلومات
    - لا تأخذ في الاعتبار الفروق الفردية بين الطلبة
    - تأخذ في الاعتبار الفروق الفردية
الإجابة الصحيحة: لا تأخذ في الاعتبار الفروق الفردية بين الطلبة

4. لطريقة المناقشة عدة عيوب منها:
    - اشتراك عدد كبير من المتعلمين في المناقشة
    - استماع المتعلمين لما يطرحة زملاؤهم
    - سيطرة عدد محدود من المتعلمين على المناقشة
    - تمكن المعلم من السيطرة على المناقشة
الإجابة الصحيحة: سيطرة عدد محدود من المتعلمين على المناقشة

5. من المبادئ التي يجب ان يراعيها المعلم لتحسين طريقة التدريس:
    - مراعاة الفروق الفردية بين المتعلمين
    - توفر مبادئ التعلم والتعليم في الطريقة
    - تنظيم المحتوى بطريقة تباعد على التعلم الذاتي (الأصح: تساعد على التعلم الذاتي)
    - جميع ما سبق ذكرة
الإجابة الصحيحة: جميع ما سبق ذكرة (مع التحفظ على صياغة الخيار الثالث)

6. ما يلي من معايير اختيار طريقة التدريس عدا:
    - التدرج من الصعب الى السهل
    - التدرج من البسيط الى المركب
    - الانتقال من العملي الى النظري
    - الانتقال من المحسوس الى المعقول
الإجابة الصحيحة: التدرج من الصعب الى السهل (المعيار هو التدرج من السهل إلى الصعب)

7. ما يلي من استخدامات المحاضرة في مجالات عديدة ماعدا:
    - مناقشة الطلاب فيما يفعلونة
    - تقديد موضوع جديد (تقديم)
    - تلخيص ما سبق للطلة دراستة
    - توجية وارشاد الطلبة الى مصادر معروفة
الإجابة الصحيحة: مناقشة الطلاب فيما يفعلونة (المناقشة طريقة أخرى)

8. من مزايا طريقة المناقشة:
    - تدفع المتعلمين الى المشاركة بالدرس
    - تنمي القدرات الفكرية والمعرفية للمتعلين
    - تنمي لدى المتعلمين حب التعاون والعمل الجماعي
    - جميع ما سبق ذكرة
الإجابة الصحيحة: جميع ما سبق ذكرة

9. ما يلي من إجراءات طريقة حل المشكلات ماعدا:
    - الوصول الى احكام عامة حول المشكلة
    - مناقشة الموضوعات القريبة للمشكلة
    - الإحساس بالمشكلة
    - تحديد المشكلة
الإجابة الصحيحة: مناقشة الموضوعات القريبة للمشكلة (هذه قد تكون جزء من جمع المعلومات أو توليد الحلول، وليست خطوة أساسية مميزة كالبقية أو قد تكون مضللة إذا لم تكن المشكلة نفسها)

10. من شروط المشكلة المختارة للدراسة:
    - تكويت مناسبة للدراسة وذات صلة قوية بالدرس (تكون)
    - تكون من المشكلات التي يعاني منها المجتمع
    - تكون ذات صلة بمشكلات البيئة
    - جميع ما سبق
الإجابة الصحيحة: جميع ما سبق

11. ما يلي من مميزات طريقة المحاضرة ماعدا:
    - طريقة تدريس اقتصادية
    - تسهم في تذكر الطلاب للمعومات
    - تغطي حجم كبي من محتوى المقرر
    - لا تحتاج لامكانيات كبيرة
الإجابة الصحيحة: تسهم في تذكر الطلاب للمعومات (مكرر من السؤال 1 في هذه الفقرة)

12. مراحل عملية التدريس هي:
    - مرحلة النخطيط
    - مرحلة التنفيذ
    - مرحلة التقويم
    - جميع ما سبق
الإجابة الصحيحة: جميع ما سبق (مكرر من السؤال 2 في هذه الفقرة)

13. من النتقادات الموجهة لطريقة التدريس: (يفترض لطريقة المحاضرة)
    - تثير دافعية الطلبة للتعلم
    - يمكن من خلالها إعطاء كم من المعلومات
    - لا تأخذ في الاعتبار الفروق الفردية بين الطلبة
    - تأخذ فى الاعتبار الفروق الفردية بين الطلبة
الإجابة الصحيحة: لا تأخذ في الاعتبار الفروق الفردية بين الطلبة (مكرر من السؤال 3 في هذه الفقرة)

14. من المبادئ التي يجب ان يراعيها المعلم لتحسين طريقة التدريس:
    - مراعاة الفروق الفردية بين المتعلمين
    - توفر مبادئ التعلم والتعليم في الطريقة
    - تنظيم المحتوى بطريقة تساعد على التعلم الذاتي
    - جميع ما سبق ذكرة
الإجابة الصحيحة: جميع ما سبق ذكرة (مكرر من السؤال 5 في هذه الفقرة)

15. ما يلي من معايير اختيار طريقة التدريس ماعدا:
    - التدرج من الصعب الى السهل
    - التدرج من البسيط الى المركب
    - الانتقال من العملي للنظري
    - الانتقال من المحسوس الى المعقول
الإجابة الصحيحة: التدرج من الصعب الى السهل (مكرر من السؤال 6 في هذه الفقرة)

16. ما يلي من استخدامات المحاضرة في مجالات عديدة ماعدا:
    - مناقشة الطلاب في ما يفعلونة
    - تقديم موضوع جديد
    - تلخيص ما سبق للطلبة دراستة
    - توجية وارشاد الطلبة الى مصادر المعرفة
الإجابة الصحيحة: مناقشة الطلاب في ما يفعلونة (مكرر من السؤال 7 في هذه الفقرة)

17. من مزايا طريقة المناقشة:
    - تدفع المتعلمين الى المشاركة بالدرس
    - تنمى القدرات الفكرية والمعرفية للمتعلمين
    - تنمى لدى المتعلمين حب التعاون والعمل الجماعي
    - جميع ما سبق ذكرة
الإجابة الصحيحة: جميع ما سبق ذكرة (مكرر من السؤال 8 في هذه الفقرة)

18. لطريقة المناقشة عدة عيوب منها:
    - اشتراك عدد كبير من المتعلمين في المناقشة
    - استماع المتعلمين لما يطرحه زملاؤهم
    - سيطرة عدد محدود من المتعلمين على المناقشة
    - تمكن المعلم من السيطرة على المناقشة
الإجابة الصحيحة: سيطرة عدد محدود من المتعلمين على المناقشة (مكرر من السؤال 4 في هذه الفقرة)

19. ما يلي من إجراءات طريقة حل المشكلات ماعدا:
    - الوصول الى أحكام عامه حول المشكلة
    - مناقشه الموضوعات القريبة للمشكلة
    - الاحساس بالمشكلة
    - تحديد المشكلة
الإجابة الصحيحة: مناقشه الموضوعات القريبة للمشكلة (مكرر من السؤال 9 في هذه الفقرة)

20. من شروط المشكلة المختارة للدراسة:
    - تكون مناسبة للدراسة وذات صلة قوية بالدرس
    - تكون من المشكلات التي يعاني منها المجتمع
    - تكون ذات صلة بمشكلات البيئة
    - جميع ما سبق
الإجابة الصحيحة: جميع ما سبق (مكرر من السؤال 10 في هذه الفقرة)

21. من إجراءات طريقة حل المشكلة:
    - يساعد المعلم طلابه على اختيار المشكلة المناسبة
    - التقويم المستمر المصاحب لطريقة حل المشكلات
    - يحث المعلم طلابه على القراءة والاطلاع على مصادر المعرفة
    - جميع ما سبق
الإجابة الصحيحة: جميع ما سبق

22. ما يلي من مزايا طريقة حل المشكلات ماعدا:
    - تنمية التفكير العلمي عند الطلاب
    - تنمية المهارات العملية والتطبيقية للطلاب
    - تنمية روح العمل الجماعي بين الطلاب
    - تدريب المتعلمين على مواجهة المشكلات في الحياة الواقعية
الإجابة الصحيحة: تنمية المهارات العملية والتطبيقية للطلاب (بينما هي تنميها، قد تكون الخيارات الأخرى أقوى أو أن هناك خيار أدق، لكن جميعها من المزايا. إذا كان لا بد من اختيار "ما عدا"، فقد يكون هذا الخيار هو الأقل مباشرة مقارنة بتنمية التفكير العلمي.)
(ملاحظة: كل الخيارات المذكورة هي من مزايا طريقة حل المشكلات. قد يكون هناك خطأ في السؤال أو الخيارات.)

23. من عيوب طريقة حل المشكلات:
    - الاعتماد على المعلم وحده في اختيار المشكلة
    - عدم تعويد الطلاب على مهارات المناقشة
    - قلة المعلومات او المادة العلمية
    - جميع ما سبق
الإجابة الصحيحة: جميع ما سبق

24. للهداف التربوية أهمية منها: (للأهداف)
    - تسهم في تصميم المناهج الدراسية
    - المساعدة في اختيار استراتيجيات التدريس
    - أداة لتقويم اداء الطلاب وتحديد مدى تقدمهم
    - جميع ما سبق
الإجابة الصحيحة: جميع ما سبق

25. تصنف الأهداف التعليمية الى:
    - أهداف تربوية وأهداف تعليمية
    - أهداف عامه وأهداف خاصة وأهداف سلوكية
    - أهداف اجرائية وأهداف نفسية وأهداف اجتماعية
    - أهداف وجدانية وأهداف تربوية وأهداف سلوكية
الإجابة الصحيحة: أهداف عامه وأهداف خاصة وأهداف سلوكية

26. تصنف الاهداف بناء على المجالات التعليمية الى:
    - أهداف المناهج الدراسية وأهداف الصفوف الدراسية
    - اهداف المجال المعرفى وأهداف المجال الوجداني واهداف المجال المهاري
    - الاهداف السيكولوجية والاهداف الانفعالية والاهداف التعليمية
    - الاهداف التعليمية والنفسية والتربوية
الإجابة الصحيحة: اهداف المجال المعرفى وأهداف المجال الوجداني واهداف المجال المهاري

27. تصنيف الاهداف التعليمية له اهمية منها:
    - توضيح الرؤية
    - التخطيط الفعال
    - التقويم المنهجي
    - جميع ماسبق
الإجابة الصحيحة: جميع ماسبق

28. ما يلي من مواصفات الهدف السلوكي ماعدا:
    - يصف سلوك المتعلم
    - واضح المعنى وقابل للفهم
    - يصف سلوك المعلم (مكرر)
    - قابل للملاحظة والقياس
الإجابة الصحيحة: يصف سلوك المعلم (لأنها مكررة، أو إذا كان القصد "يصف سلوك المعلم" كخيار بديل غير مكرر، فهو خطأ لأن الهدف السلوكي يصف سلوك المتعلم)

29. فيما يلى مجموعة من الاهداف السلوكية الصحيحة ماعدا:
    - أن يشرح المعلم مكونات الحاسب الألى
    - أن يذكر التلميذ وظائف الحاسب الألى
    - أن يرسم المتعلم مكونات الحاسب الألى
    - أن يقدر المتعلم قيمة الحاسب الألى في الحياة العملية
الإجابة الصحيحة: أن يشرح المعلم مكونات الحاسب الألى (لأنه يصف سلوك المعلم وليس المتعلم)

30. يرتكز التعلم الالكترونى وفق منظوره الحديث على عدة أسس منها:
    - المتعلم إيجابي ونشط
    - الاعتماد على توليد المعارف وليس استقبالها
    - المعلم موجه ومرشد ومصمم لبيئة التعلم
    - جميع ما سبق
الإجابة الصحيحة: جميع ما سبق

31. ما يلى من خصائص بيئات التعلم التفاعلية الالكترونية ماعدا:
    - التمركز حول المعلم
    - تعاونية والمشاركة
    - اللاتزامنية في الزمان والمكان
    - الموضوعية وعدم التحيز
الإجابة الصحيحة: التمركز حول المعلم

32. توجد مجموعة من الاسس لتوظيف استراتيجيات التعلم الإلكتروني منها:
    - ارتباط الاستراتيجية بأساليب التقويم
    - ارتباط الاستراتيجية بالأهداف.
    - مراعاة ظروف المعلمين في بيئة التعلم
    - جميع ما سبق.
الإجابة الصحيحة: ارتباط الاستراتيجية بالأهداف. (بينما كل الخيارات مهمة، الارتباط بالأهداف هو الأساس الأول)

33. اختيار استراتيجيات التعلم الإلكتروني له عدة معايير منها:
    - المعلمين القائمين بالتدريس
    - تعدد البيئات التعليمية الالكترونية.
    - المتعلمين وخصائصهم
    - جميع ما سبق.
الإجابة الصحيحة: جميع ما سبق.

34. المحاضرة الالكترونية لها عدة مميزات منها:
    - يشاهد المتعلم المحاضرة فى المكان والوقت المناسب له
    - استعراض مجموعة كبيرة من الخصائص والمفاهيم فى فترة زمنية قصيره
    - إمكانية إعادة تشغيلها أو أجزاء منها لمرات متعددة
    - جميع ما سبق
الإجابة الصحيحة: جميع ما سبق

35. للتعلم التعاوني فوائد عديدة منها:
    - تبادل الافكار بين الطلاب .
    - مساعدة المعلمين في تنفيذ خططهم التدريسية.
    - زيادة الدافعية للتعلم الذاتي
    - جميع ما سبق.
الإجابة الصحيحة: جميع ما سبق. (الخيار الأول "تبادل الأفكار بين الطلاب" هو الأنسب والأكثر مباشرة كفائدة للتعلم التعاوني نفسه)

36. ما يلى من شروط التعلم التعاوني ماعدا:
    - الانضباط وعدم استغلال الوقت في اللهو
    - المجموعة تتكون من ٤ افراد او ٦ على الأكثر
    - المعلم مرجعا للطلاب في كل وقت
    - اعتماد كل من الطلبة على الأخر
الإجابة الصحيحة: اعتماد كل من الطلبة على الأخر (التعاون يتطلب مسؤولية فردية أيضاً، وليس اعتماداً كلياً)

37. التعلم بالبحث له اهمية منها:
    - جعل التعلم أسرع .
    - جعل التعلم أمتع وأعمق.
    - تنمية مهارات التعلم الذاتي لدى المتعلم .
    - جميع ما سبق.
الإجابة الصحيحة: جميع ما سبق. (تنمية مهارات التعلم الذاتي هي الأبرز)
        `;

        // --- New Question Parsing Function for qq.txt format ---
        function parseQQTxtQuestions(text) {
            const questions = [];
            let idCounter = 1;

            // Remove headers and instructions from qq.txt content
            let cleanText = text.replace(/ملف الأسئلة والأجوبة\s*/, '');
            cleanText = cleanText.replace(/ضع علامه \( √ \) أمام العبارة الصحيحة وعبارة \(x\) أمام العبارات الخاطئة\.\s*/, '');
            cleanText = cleanText.replace(/ضع دائرة حول الحرف الذي يدل على الإجابة الصحيحة:\s*/, '');
            cleanText = cleanText.replace(/---\s*/g, ''); // Remove all separator lines

            const blocks = cleanText.split(/\n(?=\d+\.\s)/)
                                 .map(b => b.trim())
                                 .filter(b => b);


            const arabicOptionMarkers = ['أ', 'ب', 'ج', 'د', 'هـ'];

            for (const block of blocks) {
                if (!block.trim()) continue;

                const lines = block.trim().split('\n').map(l => l.trim());
                if (lines.length < 2) {
                    console.warn("Skipping short block:", block);
                    continue; 
                }

                const questionLine = lines[0];
                const answerLine = lines[lines.length - 1];

                const questionMatch = questionLine.match(/^(\d+)\.\s*(.*)/);
                if (!questionMatch) {
                    console.warn("Skipping block with no question match:", block);
                    continue;
                }
                
                const originalIdFromFile = parseInt(questionMatch[1]);
                const questionText = questionMatch[2];
                let options = {};
                let type = 'true_false'; // Default to T/F

                // Process option lines (if any)
                for (let i = 1; i < lines.length - 1; i++) {
                    if (lines[i].startsWith('- ')) {
                        type = 'mcq';
                        const optionText = lines[i].substring(2).trim();
                        const optionLetter = arabicOptionMarkers[Object.keys(options).length];
                        if (optionLetter) {
                            options[optionLetter] = optionText;
                        }
                    }
                }

                let correctAnswer;
                if (type === 'true_false') {
                    const answerText = answerLine.replace(/^الإجابة:\s*/, '').split('(')[0].trim();
                    if (answerText.toUpperCase() === 'X' || answerText === 'خطأ' || answerText === 'x') {
                        correctAnswer = 'خطأ';
                    } else if (answerText === '√' || answerText === 'صح') {
                        correctAnswer = 'صح';
                    } else {
                        console.warn(`(${idCounter}) Unknown T/F answer for Q_file_${originalIdFromFile} ('${questionText.substring(0,20)}...'): ${answerText}`);
                        correctAnswer = answerText; 
                    }
                } else { // MCQ
                    let correctAnswerText = answerLine.replace(/^الإجابة الصحيحة:\s*/, '').split('(')[0].trim();
                    let matched = false;

                    const letterOnlyMatch = correctAnswerText.match(/^([أبجدهـ])(\.|\s|$)/);
                    if (letterOnlyMatch && options[letterOnlyMatch[1]]) {
                        correctAnswer = letterOnlyMatch[1];
                        matched = true;
                    }

                    if (!matched) {
                        for (const letter in options) {
                            if (options[letter] === correctAnswerText) {
                                correctAnswer = letter;
                                matched = true;
                                break;
                            }
                        }
                    }
                    
                    if (!matched) { // Fuzzy matching for common phrases or minor variations
                        const commonPhrases = [
                            "جميع ما سبق", "تسهم في تذكر الطلاب", "لا تأخذ في الاعتبار الفروق الفردية",
                            "سيطرة عدد محدود من المتعلمين على المناقشة", "التدرج من الصعب الى السهل",
                            "مناقشة الطلاب فيما يفعلونة", "مناقشة الطلاب في ما يفعلونة", 
                            "مناقشة الموضوعات القريبة للمشكلة", "مناقشه الموضوعات القريبة للمشكلة",
                            "تنمية المهارات العملية والتطبيقية للطلاب", "يصف سلوك المعلم",
                            "أن يشرح المعلم مكونات الحاسب الألى", "التمركز حول المعلم",
                            "ارتباط الاستراتيجية بالأهداف", "اعتماد كل من الطلبة على الأخر"
                        ];
                        for (const phrase of commonPhrases) {
                            if (correctAnswerText.includes(phrase)) {
                                for (const letter in options) {
                                    if (options[letter].includes(phrase)) {
                                        correctAnswer = letter;
                                        matched = true;
                                        break;
                                    }
                                }
                            }
                            if (matched) break;
                        }
                    }
                     // Attempt: Match by removing trailing period if not matched yet
                    if (!matched) {
                        for (const letter in options) {
                            if (options[letter].replace(/\.$/,'').trim() === correctAnswerText.replace(/\.$/,'').trim()) {
                                correctAnswer = letter;
                                matched = true;
                                break;
                            }
                        }
                    }

                    if (!matched) {
                        console.warn(`(${idCounter}) MCQ answer for Q_file_${originalIdFromFile} ('${questionText.substring(0,20)}...') ('${correctAnswerText}') not found in options:`, options);
                        correctAnswer = correctAnswerText; 
                    }
                }
                
                questions.push({
                    id: idCounter++, 
                    idFromFile: originalIdFromFile, 
                    type: type,
                    question: questionText,
                    options: type === 'mcq' ? options : {},
                    correctAnswer: correctAnswer
                });
            }
            console.log("Total Parsed Questions (qq.txt):", questions.length);
            return questions;
        }


        const questionsData = parseQQTxtQuestions(rawQuestionsText);


        // --- DOM Elements ---
        const mainContent = document.getElementById('exam-content');
        const welcomeScreen = document.getElementById('welcome-screen'); 
        const startExamBtn = document.getElementById('start-exam-btn'); 
        const viewOldResultsBtn = document.getElementById('view-old-results-btn'); 
        
        const questionContainer = document.getElementById('question-container'); 
        const questionNumberSpan = document.getElementById('question-number');
        const questionTextElement = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const prevBtnSingleCol = document.getElementById('prev-btn'); 
        const nextBtnSingleCol = document.getElementById('next-btn'); 
        const submitBtnSingleCol = document.getElementById('submit-btn'); 
        const timerDisplaySingleCol = document.getElementById('timer'); 
        const progressBar = document.getElementById('progress-bar');

        const resultsContainer = document.getElementById('results-container'); 
        const resultsTitle = document.getElementById('results-title'); 
        const oldResultTimestampEl = document.getElementById('old-result-timestamp');
        const scoreSpan = document.getElementById('score');
        const answeredCountSpan = document.getElementById('answered-count');
        const resultsTotalQCount1 = document.getElementById('results-total-q-count1');
        const resultsTotalQCount2 = document.getElementById('results-total-q-count2');
        const percentageSpan = document.getElementById('percentage');
        const reviewBtnSingleCol = document.getElementById('review-btn'); 
        const retakeBtnSingleCol = document.getElementById('retake-btn'); 
        const backToWelcomeBtn = document.getElementById('back-to-welcome-btn');


        const reviewContainer = document.getElementById('review-container'); 
        const reviewList = document.getElementById('review-list');
        const backToResultsBtnSingleCol = document.getElementById('back-to-results-btn'); 
        
        const modalOverlay = document.getElementById('confirmation-modal-overlay');
        let modalConfirmBtn = document.getElementById('modal-confirm-btn'); 
        const modalCancelBtn = document.getElementById('modal-cancel-btn');
        const modalTitleText = document.getElementById('modal-title-text');
        const modalMessageText = document.getElementById('modal-message-text');

        // --- Exam State Variables ---
        let currentQuestionIndex = 0;
        let userAnswers = []; 
        let score = 0;
        const EXAM_DURATION_SECONDS = 45 * 60; // 45 minutes
        let timeLeft = EXAM_DURATION_SECONDS; 
        let timerInterval;
        let examActive = false;
        const OLD_RESULTS_KEY = 'examApp_oldResults_qq'; 
        const EXAM_IN_PROGRESS_STATE_KEY = 'examApp_inProgressState_qq'; 
        const LAST_ACTIVE_SCREEN_KEY = 'examApp_lastActiveScreen_qq';


        // --- Screen Management ---
        function showActiveScreen(screenId) {
            const allScreens = document.querySelectorAll('#exam-content > .screen');
            allScreens.forEach(s => s.classList.add('hidden'));
            
            const activeScreenElement = document.getElementById(screenId);
            if(activeScreenElement) {
                activeScreenElement.classList.remove('hidden');
            } else {
                console.error("Screen not found:", screenId);
                document.getElementById('welcome-screen').classList.remove('hidden');
                localStorage.setItem(LAST_ACTIVE_SCREEN_KEY, 'welcome');
            }
        }
        
        // --- Modal Functions ---
        function showConfirmationModal(title, message, onConfirm) {
            modalTitleText.textContent = title;
            modalMessageText.textContent = message;
            modalOverlay.classList.add('active');
            
            const newConfirmBtn = modalConfirmBtn.cloneNode(true);
            modalConfirmBtn.parentNode.replaceChild(newConfirmBtn, modalConfirmBtn);
            modalConfirmBtn = newConfirmBtn; 

            modalConfirmBtn.onclick = () => { 
                onConfirm();
                hideConfirmationModal();
            };
        }
        function hideConfirmationModal() { modalOverlay.classList.remove('active'); }

        // --- In-Progress State Management ---
        function saveInProgressState() {
            if (!examActive || questionsData.length === 0) return;
            const state = {
                answers: userAnswers,
                currentIndex: currentQuestionIndex,
                timeLeft: timeLeft,
                totalQuestions: questionsData.length 
            };
            localStorage.setItem(EXAM_IN_PROGRESS_STATE_KEY, JSON.stringify(state));
        }

        function loadInProgressState() {
            const savedStateJSON = localStorage.getItem(EXAM_IN_PROGRESS_STATE_KEY);
            if (savedStateJSON) {
                try {
                    const savedState = JSON.parse(savedStateJSON);
                    if (savedState.answers && savedState.totalQuestions === questionsData.length) { 
                        userAnswers = savedState.answers;
                        if (userAnswers.length < questionsData.length) {
                            userAnswers = userAnswers.concat(new Array(questionsData.length - userAnswers.length).fill(null));
                        } else if (userAnswers.length > questionsData.length) {
                            userAnswers = userAnswers.slice(0, questionsData.length); 
                        }

                        currentQuestionIndex = savedState.currentIndex;
                        timeLeft = savedState.timeLeft;
                        if (timeLeft <=0 ) { 
                           timeLeft = 0; 
                           return 'expired'; 
                        }
                        return true; 
                    } else {
                        console.warn("Saved progress incompatible or for a different number of questions. Discarding.");
                        localStorage.removeItem(EXAM_IN_PROGRESS_STATE_KEY); 
                    }
                } catch (e) {
                    console.error("Error parsing saved state:", e);
                    localStorage.removeItem(EXAM_IN_PROGRESS_STATE_KEY); 
                }
            }
            return false; 
        }

        // --- Functions ---
        function startExam() {
            userAnswers = new Array(questionsData.length).fill(null); 
            
            let loadedState = loadInProgressState(); 
            
            // Exam duration is fixed by EXAM_DURATION_SECONDS
            // No per-question calculation needed if total time is fixed
            // let calculatedTimePerQuestion = questionsData.length > 0 ? questionsData.length * 60 : EXAM_DURATION_SECONDS; 
            // let examDuration = Math.max(EXAM_DURATION_SECONDS, calculatedTimePerQuestion); // Ensure at least the fixed duration


            if (loadedState === true) { 
                examActive = true;
                // timeLeft is already restored by loadInProgressState
                console.log("Resuming exam session.");
            } else if (loadedState === 'expired') { 
                 examActive = true; 
                 // timeLeft is 0, also restored
                 console.log("Resuming an expired exam session. Submitting immediately.");
            } else { 
                examActive = true;
                timeLeft = EXAM_DURATION_SECONDS; // Fresh start with full duration
                currentQuestionIndex = 0;
                score = 0;
                console.log("Starting a new exam session.");
            }
            
            document.querySelector('#welcome-time-duration').textContent = `${Math.floor(EXAM_DURATION_SECONDS / 60)} دقيقة`; 
            showActiveScreen('question-container');
            localStorage.setItem(LAST_ACTIVE_SCREEN_KEY, 'question');
            startTimer(); 
            displayQuestion(); 
        }


        function displayQuestion() {
            if (!examActive || currentQuestionIndex >= questionsData.length) {
                 if (examActive && currentQuestionIndex >= questionsData.length && questionsData.length > 0) {
                     if (timeLeft > 0) submitExam(); 
                     else if (!timerInterval) submitExam(true); 
                 }
                return;
            }
            const question = questionsData[currentQuestionIndex];
            if (!question) {
                console.error(`Question at index ${currentQuestionIndex} is undefined.`);
                if(examActive) submitExam(true); 
                return;
            }

            questionNumberSpan.textContent = `السؤال ${currentQuestionIndex + 1} / ${questionsData.length}`;
            questionTextElement.textContent = question.question;
            optionsContainer.innerHTML = '';

            if (question.type === 'mcq') {
                const optionKeys = Object.keys(question.options).sort(); 
                if (optionKeys.length === 0) {
                     console.warn(`MCQ Question ${currentQuestionIndex + 1} (File ID: ${question.idFromFile}) has no options. Displaying as text only.`);
                     optionsContainer.innerHTML = `<p style="color: var(--text-muted);">لا توجد خيارات لهذا السؤال.</p>`;
                } else {
                    optionKeys.forEach(key => {
                        const optionText = question.options[key];
                        const optionDiv = document.createElement('label');
                        optionDiv.className = 'option-item';
                        optionDiv.innerHTML = `
                            <input type="radio" name="question${currentQuestionIndex}" value="${key}" id="option-${currentQuestionIndex}-${key}">
                            <span class="custom-radio"></span>
                            <span>${key}. ${optionText}</span>
                        `;
                        optionsContainer.appendChild(optionDiv);
                        if (userAnswers[currentQuestionIndex] === key) {
                            optionDiv.classList.add('selected');
                            optionDiv.querySelector('input').checked = true;
                        }
                        optionDiv.addEventListener('click', () => {
                            document.querySelectorAll(`#options-container input[name="question${currentQuestionIndex}"]`).forEach(input => {
                                input.closest('.option-item').classList.remove('selected');
                            });
                            optionDiv.classList.add('selected');
                            optionDiv.querySelector('input').checked = true;
                            selectOption(key);
                        });
                    });
                }
            } else if (question.type === 'true_false') {
                ['صح', 'خطأ'].forEach(option => {
                    const optionDiv = document.createElement('label');
                    optionDiv.className = 'option-item';
                    optionDiv.innerHTML = `
                        <input type="radio" name="question${currentQuestionIndex}" value="${option}" id="option-${currentQuestionIndex}-${option}">
                        <span class="custom-radio"></span>
                        <span>${option}</span>
                    `;
                    optionsContainer.appendChild(optionDiv);
                    if (userAnswers[currentQuestionIndex] === option) {
                        optionDiv.classList.add('selected');
                        optionDiv.querySelector('input').checked = true;
                    }
                    optionDiv.addEventListener('click', () => {
                        document.querySelectorAll(`#options-container input[name="question${currentQuestionIndex}"]`).forEach(input => {
                            input.closest('.option-item').classList.remove('selected');
                        });
                        optionDiv.classList.add('selected');
                        optionDiv.querySelector('input').checked = true;
                        selectOption(option);
                    });
                });
            }
            updateNavigationButtonsSingleCol();
            updateProgressBar();
        }
        
        function selectOption(value) {
            if (currentQuestionIndex < userAnswers.length) {
                 userAnswers[currentQuestionIndex] = value;
                 saveInProgressState(); 
            } else {
                console.error("currentQuestionIndex out of bounds for userAnswers array.");
            }
        }

        function updateNavigationButtonsSingleCol() {
            prevBtnSingleCol.disabled = currentQuestionIndex === 0;
            nextBtnSingleCol.classList.toggle('hidden', currentQuestionIndex === questionsData.length - 1);
            submitBtnSingleCol.classList.toggle('hidden', currentQuestionIndex !== questionsData.length - 1);
        }

        function showPreviousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
                saveInProgressState(); 
            }
        }

        function showNextQuestion() {
            if (currentQuestionIndex < questionsData.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
                saveInProgressState(); 
            }
        }

        function updateProgressBar() {
            const progress = questionsData.length > 0 ? ((currentQuestionIndex + 1) / questionsData.length) * 100 : 0;
            progressBar.style.width = `${progress}%`;
        }

        function startTimer() {
            clearInterval(timerInterval); 
            timerDisplaySingleCol.innerHTML = `<i class="fa-solid fa-clock-rotate-left"></i> الزمن المتبقي: ${formatTime(timeLeft)}`;
            
            if(timeLeft <= 0 && examActive) { 
                timerDisplaySingleCol.innerHTML = '<i class="fa-solid fa-hourglass-end"></i> انتهى الوقت!';
                submitExam(true); 
                return;
            }

            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplaySingleCol.innerHTML = `<i class="fa-solid fa-clock-rotate-left"></i> الزمن المتبقي: ${formatTime(timeLeft)}`;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timerInterval = null; 
                    timerDisplaySingleCol.innerHTML = '<i class="fa-solid fa-hourglass-end"></i> انتهى الوقت!';
                    if (examActive) submitExam(true); 
                }
                 saveInProgressState(); 
            }, 1000);
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        function confirmAndSubmitExam() { 
            showConfirmationModal(
                'تأكيد تسليم الإجابات النهائية',
                'بمجرد التأكيد، سيتم تسجيل إجاباتك ولا يمكن تغييرها. هل أنت مستعد للمتابعة؟',
                () => submitExam(false) 
            );
        }

        function submitExam(timeUp = false) {
            if (!examActive && !timeUp && questionsData.length === 0) return; 

            clearInterval(timerInterval);
            timerInterval = null; 
            examActive = false; 
            score = 0;
            let answeredCount = 0;
            questionsData.forEach((question, index) => {
                const userAnswer = userAnswers[index]; 
                if (userAnswer !== null && userAnswer !== undefined) {
                    answeredCount++;
                    if (userAnswer === question.correctAnswer) {
                        score++;
                    }
                }
            });

            const currentResults = {
                score: score,
                answeredCount: answeredCount,
                totalQuestions: questionsData.length,
                percentage: questionsData.length > 0 ? (score / questionsData.length) * 100 : 0,
                timestamp: new Date().toLocaleString('ar-EG'),
                userAnswersForReview: userAnswers 
            };
            localStorage.setItem(OLD_RESULTS_KEY, JSON.stringify(currentResults));
            localStorage.removeItem(EXAM_IN_PROGRESS_STATE_KEY); 
            localStorage.setItem(LAST_ACTIVE_SCREEN_KEY, 'results');

            displayResults(currentResults, { isPostSubmit: true, showReview: true }); 
        }

        function displayResults(resultsData, options = { isPostSubmit: false, showReview: false }) {
            showActiveScreen('results-container');
            answeredCountSpan.textContent = resultsData.answeredCount;
            scoreSpan.textContent = resultsData.score;
            resultsTotalQCount1.textContent = resultsData.totalQuestions;
            resultsTotalQCount2.textContent = resultsData.totalQuestions;
            percentageSpan.textContent = `النسبة المئوية للإتقان: ${resultsData.percentage.toFixed(1)}%`;

            if (options.isPostSubmit) { 
                resultsTitle.innerHTML = `<i class="fa-solid fa-medal"></i> تقرير الأداء النهائي`;
                retakeBtnSingleCol.classList.remove('hidden');
                backToWelcomeBtn.classList.add('hidden');
                oldResultTimestampEl.classList.add('hidden');
            } else {  
                resultsTitle.innerHTML = `<i class="fa-solid fa-history"></i> نتيجة سابقة`;
                retakeBtnSingleCol.classList.add('hidden'); 
                backToWelcomeBtn.classList.remove('hidden');
                if (resultsData.timestamp) {
                    oldResultTimestampEl.textContent = `تم إكمال هذا الاختبار في: ${resultsData.timestamp}`;
                    oldResultTimestampEl.classList.remove('hidden');
                } else {
                     oldResultTimestampEl.classList.add('hidden');
                }
            }

            if(options.showReview && resultsData.userAnswersForReview && resultsData.userAnswersForReview.length > 0) {
                reviewBtnSingleCol.classList.remove('hidden');
            } else {
                reviewBtnSingleCol.classList.add('hidden');
            }
        }


        function showReviewScreen() {
            let answersForReview = userAnswers; 
            if (!answersForReview || answersForReview.length === 0 || answersForReview.every(ans => ans === null)) {
                const lastExamDataJSON = localStorage.getItem(OLD_RESULTS_KEY);
                if (lastExamDataJSON) {
                    const lastExamData = JSON.parse(lastExamDataJSON);
                    if (lastExamData.userAnswersForReview && lastExamData.userAnswersForReview.length > 0) {
                        answersForReview = lastExamData.userAnswersForReview;
                    } else {
                         console.warn("Review: No answers in memory or storage for last exam.");
                         showResultsScreen(); 
                         return;
                    }
                } else {
                    console.warn("Review: No answers in memory and no last exam data.");
                    showResultsScreen();
                    return;
                }
            }
            if (answersForReview.length !== questionsData.length) {
                console.warn("Review: Answer data length mismatch with current questions. Showing best effort.");
            }


            showActiveScreen('review-container');
            localStorage.setItem(LAST_ACTIVE_SCREEN_KEY, 'review');
            reviewList.innerHTML = '';
            questionsData.forEach((question, index) => {
                const reviewItemDiv = document.createElement('div');
                reviewItemDiv.className = 'review-item'; 
                const userAnswerFromStore = index < answersForReview.length ? answersForReview[index] : null; 
                const isCorrect = (userAnswerFromStore !== null && userAnswerFromStore === question.correctAnswer);

                if (userAnswerFromStore === null || userAnswerFromStore === undefined) {
                    reviewItemDiv.classList.add('review-item-unanswered');
                } else if (isCorrect) {
                    reviewItemDiv.classList.add('review-item-correct');
                } else {
                    reviewItemDiv.classList.add('review-item-incorrect');
                }
                
                let userAnswerText = 'لم تتم الإجابة';
                if (userAnswerFromStore !== null && userAnswerFromStore !== undefined) {
                    userAnswerText = `إجابتك: ${userAnswerFromStore}`;
                    if (question.type === 'mcq' && question.options && question.options[userAnswerFromStore]) {
                        userAnswerText += `. ${question.options[userAnswerFromStore]}`;
                    }
                }
                let correctAnswerDisplay = `الإجابة الصحيحة: ${question.correctAnswer}`;
                if (question.type === 'mcq' && question.options && question.options[question.correctAnswer]) {
                    correctAnswerDisplay += `. ${question.options[question.correctAnswer]}`;
                }
                
                let resultFeedbackHtml = '';
                if (userAnswerFromStore !== null && userAnswerFromStore !== undefined) { 
                    if (isCorrect) {
                        resultFeedbackHtml = `<p class="correct-answer-review">إجابة صحيحة!</p>`;
                    } else {
                        resultFeedbackHtml = `<p class="correct-answer-review">${correctAnswerDisplay}</p>`;
                    }
                } else { 
                     resultFeedbackHtml = `<p class="correct-answer-review">${correctAnswerDisplay}</p>`;
                }


                reviewItemDiv.innerHTML = `
                    <p class="question-text-review"><strong>سؤال ${index + 1} (ملف:${question.idFromFile}):</strong> ${question.question}</p>
                    <p class="your-answer-review">${userAnswerText}</p>
                    ${resultFeedbackHtml}
                `;
                reviewList.appendChild(reviewItemDiv);
            });
        }

        function showResultsScreen() { 
            showActiveScreen('results-container');
            localStorage.setItem(LAST_ACTIVE_SCREEN_KEY, 'results');
            const lastExamDataJSON = localStorage.getItem(OLD_RESULTS_KEY);
            if (lastExamDataJSON) {
                const lastExamData = JSON.parse(lastExamDataJSON);
                displayResults(lastExamData, { isPostSubmit: true, showReview: !!(lastExamData.userAnswersForReview && lastExamData.userAnswersForReview.length > 0) });
            } else {
                resetExam(); 
            }
        }

        function resetExam() {
            localStorage.removeItem(EXAM_IN_PROGRESS_STATE_KEY); 
            localStorage.setItem(LAST_ACTIVE_SCREEN_KEY, 'welcome');
            showActiveScreen('welcome-screen');
            
            timeLeft = EXAM_DURATION_SECONDS; // Reset to full 45 minutes

            timerDisplaySingleCol.innerHTML = `<i class="fa-solid fa-clock-rotate-left"></i> الزمن المتبقي: ${formatTime(timeLeft)}`;
            document.querySelector('#welcome-time-duration').textContent = `${Math.floor(timeLeft/60)} دقيقة`; 
            progressBar.style.width = '0%';
            clearInterval(timerInterval); 
            timerInterval = null;
            examActive = false; 
            userAnswers = new Array(questionsData.length).fill(null); 
        }
        
        function showOldResults() {
            const savedResultsJSON = localStorage.getItem(OLD_RESULTS_KEY);
            if (savedResultsJSON) {
                const oldData = JSON.parse(savedResultsJSON);
                const canReviewThis = !!(oldData && oldData.userAnswersForReview && oldData.userAnswersForReview.length > 0 && oldData.totalQuestions === questionsData.length);
                
                displayResults(oldData, { isPostSubmit: false, showReview: canReviewThis }); 
                if(canReviewThis){
                    userAnswers = oldData.userAnswersForReview; 
                }

            } else {
                 showConfirmationModal(
                    'لا توجد نتائج سابقة',
                    'لم يتم العثور على أي نتائج اختبارات سابقة محفوظة في هذا المتصفح.',
                    () => {} 
                );
                const confirmBtnForInfo = document.getElementById('modal-confirm-btn');
                if(confirmBtnForInfo) confirmBtnForInfo.textContent = 'موافق';
                 const cancelBtnForInfo = document.getElementById('modal-cancel-btn');
                if(cancelBtnForInfo) cancelBtnForInfo.style.display = 'none'; 
            }
        }

        // --- Event Listeners ---
        startExamBtn.addEventListener('click', startExam);
        viewOldResultsBtn.addEventListener('click', showOldResults); 
        prevBtnSingleCol.addEventListener('click', showPreviousQuestion);
        nextBtnSingleCol.addEventListener('click', showNextQuestion);
        submitBtnSingleCol.addEventListener('click', confirmAndSubmitExam); 
        reviewBtnSingleCol.addEventListener('click', showReviewScreen);
        retakeBtnSingleCol.addEventListener('click', resetExam);
        backToResultsBtnSingleCol.addEventListener('click', showResultsScreen);
        backToWelcomeBtn.addEventListener('click', () => {
            resetExam(); 
        }); 
        
        modalCancelBtn.addEventListener('click', () => {
            hideConfirmationModal();
            const mCancelBtn = document.getElementById('modal-cancel-btn');
            if(mCancelBtn) mCancelBtn.style.display = 'inline-flex'; 
        });
        modalOverlay.addEventListener('click', (event) => {
            if (event.target === modalOverlay) {
                hideConfirmationModal();
                const mCancelBtn = document.getElementById('modal-cancel-btn');
                if(mCancelBtn) mCancelBtn.style.display = 'inline-flex';
            }
        });

        window.addEventListener('beforeunload', () => {
            if (examActive && questionsData.length > 0) {
                saveInProgressState();
            }
        });


        document.addEventListener('DOMContentLoaded', () => {
            if (questionsData.length === 0) {
                console.error("No questions were parsed. Check console for parsing warnings.");
                document.body.innerHTML = "<div style='color:var(--text-primary); text-align:center; padding: 50px; font-size:1.5em; font-family: var(--font-main);'>حدث خطأ في تحميل الأسئلة. يرجى التحقق من وحدة التحكم (Console) لمزيد من التفاصيل وتحديث الصفحة أو الاتصال بالدعم.</div>";
                startExamBtn.disabled = true;
                viewOldResultsBtn.disabled = true;
                return;
            }
            
            userAnswers = new Array(questionsData.length).fill(null); 

            const welcomeP1 = document.querySelector('#welcome-screen p:nth-of-type(1)');
            if (welcomeP1) {
                welcomeP1.textContent = `انطلق في رحلة معرفية مع ${questionsData.length} سؤالاً مصممة لاختبار حدود فهمك. التركيز هو مفتاحك للنجاح.`;
            }
            
            // Initial time display set to 45 minutes
            timerDisplaySingleCol.innerHTML = `<i class="fa-solid fa-clock-rotate-left"></i> الزمن المتبقي: ${formatTime(EXAM_DURATION_SECONDS)}`;
            document.querySelector('#welcome-time-duration').textContent = `${Math.floor(EXAM_DURATION_SECONDS / 60)} دقيقة`;

            const inProgressStateLoaded = loadInProgressState(); 
            const lastScreen = localStorage.getItem(LAST_ACTIVE_SCREEN_KEY);
            const lastCompletedExamJSON = localStorage.getItem(OLD_RESULTS_KEY);
            let lastCompletedExamData = null;
            if(lastCompletedExamJSON) {
                try {
                    lastCompletedExamData = JSON.parse(lastCompletedExamJSON);
                } catch(e) {
                    console.error("Error parsing last completed exam JSON:", e);
                    localStorage.removeItem(OLD_RESULTS_KEY); 
                }
            }


            if (inProgressStateLoaded === true || inProgressStateLoaded === 'expired') {
                startExam(); 
            } else if (lastScreen === 'results' && lastCompletedExamData && lastCompletedExamData.totalQuestions === questionsData.length) {
                 if (lastCompletedExamData.userAnswersForReview) { 
                    userAnswers = lastCompletedExamData.userAnswersForReview;
                 }
                displayResults(lastCompletedExamData, { isPostSubmit: true, showReview: !!(lastCompletedExamData.userAnswersForReview && lastCompletedExamData.userAnswersForReview.length > 0) });
            } else if (lastScreen === 'review' && lastCompletedExamData && lastCompletedExamData.totalQuestions === questionsData.length && lastCompletedExamData.userAnswersForReview) {
                userAnswers = lastCompletedExamData.userAnswersForReview; 
                showReviewScreen(); 
            }
            else { 
                showActiveScreen('welcome-screen');
                localStorage.setItem(LAST_ACTIVE_SCREEN_KEY, 'welcome');
            }
        });
    </script>
</body>
</html>